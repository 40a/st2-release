# there's no action with the same ref

---
version: '2.0'

st2-release.trigger:
  description: A workflow for confirming and triggering a StackStorm release.
  input:
    - id
    - user
    - channel
  output:
    stdout: <% $.stdout %>
  tasks:
    request:
      action: st2.executions.get
      input:
        id: <% $.id %>
      publish:
        execution: <% $.request.result %>
      on-success: previous_triggers
      on-error: wrong_execution
    previous_triggers:
      action: st2.executions.list
      input:
        action: st2-release.trigger
        status: success
      on-success: confirm
    confirm:
      action: st2-release.confirm
      input:
        execution: <% $.execution %>
        user: <% $.user %>
        previous: <% $.previous_triggers.result %>
      publish:
        confirmation: <% $.confirm.result %>
    wrong_execution:
      action: chatops.post_message
      input:
        channel: <% $.channel %>
        user: <% $.user %>
        message: "lol, say what? That's not even an execution id."
